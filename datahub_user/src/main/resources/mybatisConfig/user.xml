<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- tblNameCN:工号信息 llbtmp_admin -->
<mapper namespace="user">
	<resultMap id="userMap" type="_User">
		<result column="USER_ID" property="userId" />  <!-- id -->
		<result column="USER_STATUS" property="userStatus" />  <!-- 状态 -->
		<result column="USER_TYPE" property="userType" />  <!-- 用户类型 -->
		<result column="ARRANG_TYPE" property="arrangType" />  <!-- xxx -->
		<result column="LOGIN_NAME" property="loginName" />  <!-- 用户名 -->
		<result column="NICK_NAME" property="nickName" />  <!-- 用户名 -->
		<result column="LOGIN_PASSWD" property="loginPasswd" />  <!-- 登录密码 -->
		<result column="SELL_LEVEL" property="sellLevel" />  <!-- 销售水平 -->
	</resultMap>

	<resultMap type="java.util.HashMap" id="userExtendMap"
		extends="userMap">
	</resultMap>

	<sql id="updateSql">
		<if test="userStatus != null and userStatus != '' ">, USER_STATUS=#{userStatus}</if>
		<if test="userType != null and userType != ''"> ,USER_TYPE=#{userType,jdbcType=VARCHAR}</if>
		<if test="arrangType != null and arrangType != '' "> ,ARRANG_TYPE=#{arrangType,jdbcType=VARCHAR}</if>
		<if test="loginName != null and loginName != '' "> ,LOGIN_NAME=#{loginName,jdbcType=VARCHAR}</if>
		<if test="nickName != null and nickName != '' "> ,NICKE_NAME=#{nickName,jdbcType=VARCHAR}</if>
		<if test="loginPasswd != null and loginPasswd != '' "> ,LOGIN_PASSWD=#{loginPasswd,jdbcType=VARCHAR}</if>
		<if test="sellLevel != null and sellLevel != '' "> ,SELL_LEVEL=#{sellLevel,jdbcType=VARCHAR}</if>
		<!-- <if test="endTime != null and endTime != '' "> ,end_time=#{endTime,jdbcType=DATE}</if> -->
		<!-- <if test="target != null and target != '' "> ,empty_blob()</if> -->
	</sql>

<!-- 
	<sql id="querySql">
		<if test="userId != null"> and (M.ID = #{id} ) </if>
		<if test="account != null"> and (M.account = #{account} ) </if>
		<if test="password != null"> and (M.password = #{password} ) </if>
		<if test="name != null"> and (M.NAME = #{name} ) </if>
		<if test="notesEmail != null"> and (M.NOTESEMAIL = #{notesEmail} ) </if>
		<if test="phone != null"> and (M.PHONE = #{phone} ) </if>
		<if test="email != null"> and (M.EMAIL = #{email} ) </if>
		<if test="operateType != null"> and (M.OPERATE_TYPE = #{operateType} ) </if>
		<if test="dealStatus != null"> and (M.DEAL_STATUS = #{dealStatus} ) </if>
	</sql>
	<sql id="querySqlDim">
		<if test="id != null and id != '' "> and (M.ID like '%'||#{id}||'%' ) </if>
		<if test="password != null"> and (M.password = #{password} ) </if>
		<if test="account != null and account != '' "> and (M.account like '%'||#{account}||'%' ) </if>
		<if test="name != null and name != '' "> and (M.NAME like '%'||#{name}||'%' ) </if>
		<if test="notesEmail != null and notesEmail != '' "> and (M.NOTESEMAIL like '%'||#{notesEmail}||'%' ) </if>
		<if test="phone != null and phone != '' "> and (M.PHONE like '%'||#{phone}||'%' ) </if>
		<if test="email != null and email != '' "> and (M.EMAIL like '%'||#{email}||'%' ) </if>
		<if test="operateType != null and operateType != '' "> and (M.OPERATE_TYPE like '%'||#{operateType}||'%' ) </if>
		<if test="dealStatus != null and dealStatus != '' "> and (M.DEAL_STATUS like '%'||#{dealStatus}||'%' ) </if>
	</sql>
 -->
	<update id="updateUser" parameterType="_User">
		update DH_USER set LOGIN_NAME=#{loginName}
		<include refid="updateSql" />
		where LOGIN_NAME=#{loginName}
	</update>
	
	<select id="searchUser" parameterType="_User" resultMap="_User">
		select * from DH_USER where LOGIN_NAME=#{loginName}
	</select>

	<select id="select_admin_withPage" resultMap="userMap"
		parameterType="java.util.Map">
		SELECT * FROM (SELECT MYROW.*, ROWNUM RN
		FROM (
		SELECT
		M.ID,M.account,M.NAME,N.BRANCH_NAME
		BRANCH_ID,decode(GENDER,'M','男','F','女')
		GENDER,decode(CRED_TYPE,'A','身份证','B','军人身份证'，'C','护照','D','其他证件')
		CRED_TYPE,M.CRED_NUM,M.PHONE,M.CELLPHONE,M.NOTESEMAIL,M.EMAIL,
		decode(M.OPERATE_TYPE,'A','新增','U','修改','D','删除')
		OPERATE_TYPE,decode(M.DEAL_STATUS,'0'
		,'待审核','1','审核通过','2','审核不通过'
		)DEAL_STATUS
		from llbtmp_admin m,llbtmp_branch n
		where m.deal_status!=0
		and m.branch_id=n.id
		<include refid="querySqlDim" />
		) MYROW  <![CDATA[
		WHERE ROWNUM <= #{_end}
		) 
		WHERE RN >= #{_begin}]]>
		ORDER BY ID DESC
	</select>

	<!-- 根据条件查询满足条件的(商户信息)记录数 -->
	<select id="select_admin_count" parameterType="java.util.HashMap"
		resultType="java.lang.Integer">
		SELECT COUNT(*)
		from llbtmp_admin m
		where m.deal_status!=0
		<include refid="querySqlDim" />
	</select>
	<select id="select_admin_withPage_0" resultMap="userMap"
		parameterType="java.util.Map">
		SELECT * FROM (SELECT MYROW.*, ROWNUM RN
		FROM (
		SELECT
		M.ID,M.account,M.NAME,N.BRANCH_NAME
		BRANCH_ID,decode(GENDER,'M','男','F','女')
		GENDER,decode(CRED_TYPE,'A','身份证','B','军人身份证'，'C','护照','D','其他证件')
		CRED_TYPE,M.CRED_NUM,M.PHONE,M.CELLPHONE,M.NOTESEMAIL,M.EMAIL,
		decode(M.OPERATE_TYPE,'A','新增','U','修改','D','删除')
		OPERATE_TYPE,decode(M.DEAL_STATUS,'0'
		,'待审核','1','审核通过','2','审核不通过'
		)DEAL_STATUS
		from llbtmp_admin m,llbtmp_branch n
		where m.deal_status=0
		and m.branch_id=n.id
		<include refid="querySqlDim" />
		) MYROW  <![CDATA[
		WHERE ROWNUM <= #{_end}
		) 
		WHERE RN >= #{_begin}]]>
		ORDER BY ID DESC
	</select>
	<!-- 根据条件查询满足条件的(商户信息)记录数 -->
	<select id="select_admin_count_0" parameterType="java.util.HashMap"
		resultType="java.lang.Integer">
		SELECT COUNT(*)
		from llbtmp_admin m
		where m.deal_status=0
		<include refid="querySqlDim" />
	</select>

	<!-- 用户登录查询 -->
	<select id="userLogin" parameterType="_User" resultType="_User">
		select *
		from DH_USER where LOGIN_NAME = #{loginName,jdbcType=VARCHAR} and
		LOGIN_PASSWD = #{loginPasswd,jdbcType=VARCHAR}
	</select>

	<select id="getAlluser" parameterType="_User" resultType="_User">
		select
		* from DH_USER limit 1
	</select>

</mapper>
